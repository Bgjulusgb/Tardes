<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Signal Dashboard</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; background: #0b1220; color: #e6edf3; }
      h2 { margin-bottom: 8px; }
      #signals { display: grid; gap: 10px; }
      .card { background: #151c2f; border: 1px solid #223; padding: 12px; border-radius: 8px; }
      .buy { border-left: 4px solid #16a34a; }
      .sell { border-left: 4px solid #dc2626; }
      .meta { font-size: 12px; opacity: 0.8; }
      .row { display: flex; gap: 12px; align-items: center; }
      .row > div { min-width: 90px; }
    </style>
  </head>
  <body>
    <h2>Live Signale</h2>
    <div class="meta">Aktualisierung jede Minute 路 Browser-Benachrichtigungen aktiviert</div>
    <div id="signals"></div>

    <script>
      const list = document.getElementById('signals');
      const sse = new EventSource('/events');

      function addCard(msg) {
        const s = msg.payload || msg;
        const div = document.createElement('div');
        const isBuy = (s.action || '').toUpperCase().includes('KAUF');
        const isSell = (s.action || '').toUpperCase().includes('VERKAUF');
        div.className = `card ${isBuy ? 'buy' : ''} ${isSell ? 'sell' : ''}`;
        div.innerHTML = `
          <div class="row">
            <div><strong>Symbol</strong><br>${s.crypto}</div>
            <div><strong>Aktion</strong><br>${s.action}</div>
            <div><strong>Preis</strong><br>${Number(s.preis || 0).toFixed(6)}</div>
            <div><strong>Menge</strong><br>${s.menge ?? '-'}</div>
            <div><strong>Anteil %</strong><br>${s.anteil ?? '-'}</div>
            <div><strong>Strategie</strong><br>${s.strategie ?? '-'}</div>
            <div><strong>Konfidenz</strong><br>${s.konfidenz ?? '-'}</div>
            <div><strong>Zeit</strong><br>${s.timestamp ?? new Date().toISOString()}</div>
          </div>
        `;
        list.prepend(div);
      }

      sse.onmessage = (ev) => {
        try {
          const msg = JSON.parse(ev.data);
          if (msg.type === 'signal') {
            addCard(msg);
            if (Notification && Notification.permission === 'granted') {
              const s = msg.payload;
              new Notification(`${s.crypto} 路 ${s.action}`, { body: `Preis ${s.preis} 路 Menge ${s.menge} 路 ${s.strategie}` });
            }
          }
        } catch (e) { console.error(e); }
      };

      if (Notification && Notification.permission !== 'granted') {
        Notification.requestPermission();
      }
    </script>
  </body>
  </html>

